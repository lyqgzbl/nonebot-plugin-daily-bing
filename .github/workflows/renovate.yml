name: Renovate Self-Hosteds

on:
  schedule:
    - cron: '0 0 * * MON' 
  workflow_dispatch: 

env:
  RENOVATE_PLATFORM: 'github'
  LOG_LEVEL: 'info' 
  RENOVATE_ALLOWED_COMMANDS: '["^(pip install uv)$", "^(uv lock)$"]'

jobs:
  renovate:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write
    steps:
      - name: ‚¨áÔ∏è Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.RENOVATE_TOKEN }}
          
      - name: üë§ Setup Git Identity
        run: |
          git config --global user.email "renovate[bot]@users.noreply.github.com"
          git config --global user.name "Renovate Bot"

      - name: üöÄ Run Renovate Self-Hosted
        run: |
          docker run \
            --rm \
            --uesr root \
            -e RENOVATE_TOKEN="${{ secrets.RENOVATE_TOKEN }}" \
            -e RENOVATE_PLATFORM="${{ env.RENOVATE_PLATFORM }}" \
            -e LOG_LEVEL="${{ env.LOG_LEVEL }}" \
            -e RENOVATE_ALLOWED_COMMANDS='${{ env.RENOVATE_ALLOWED_COMMANDS }}' \
            -v "$PWD:/usr/app/repo" \
            renovate/renovate:latest \
            --base-dir /usr/app/repo